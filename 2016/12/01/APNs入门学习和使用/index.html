<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Java、分布式、大数据、微服务、机器学习"><title>APNs入门学习和使用 | Coselding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">APNs入门学习和使用</h1><a id="logo" href="/.">Coselding</a><p class="description">非淡泊无以明志，非宁静无以致远。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/timeline/"><i class="fa fa-hourglass-start"> 时间轴</i></a><a href="/old/"><i class="fa fa-link"> 以前</i></a><a href="/about/"><i class="fa fa-user"> 关于我</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">APNs入门学习和使用</h1><div class="post-meta">Dec 1, 2016<span> | </span><span class="category"><a href="/categories/推送/">推送</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a href="/2016/12/01/APNs入门学习和使用/#comments" class="ds-thread-count cloud-tie-join-count"><span style="font-size: 15px; color: #6E7173;" class="join-count">0</span><span> 条参与</span></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP-2"><span class="toc-number">1.</span> <span class="toc-text">HTTP/2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OkHttp学习和使用"><span class="toc-number">2.</span> <span class="toc-text">OkHttp学习和使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#APNs"><span class="toc-number">3.</span> <span class="toc-text">APNs</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#额外收获"><span class="toc-number">4.</span> <span class="toc-text">额外收获</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#环境配置："><span class="toc-number">5.</span> <span class="toc-text">环境配置：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境说明："><span class="toc-number">5.1.</span> <span class="toc-text">环境说明：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#步骤："><span class="toc-number">5.2.</span> <span class="toc-text">步骤：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#你的整个推送消息体封装好之后，在网络http-2传输过程中的最终传输的数据格式如下，主要包括headers和body-data："><span class="toc-number">5.2.0.0.0.1.</span> <span class="toc-text">你的整个推送消息体封装好之后，在网络http/2传输过程中的最终传输的数据格式如下，主要包括headers和body data：</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#消息包装实战"><span class="toc-number">6.</span> <span class="toc-text">消息包装实战</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#消息json中的aps字段一看就知道是apple推送到设备之后的专属识别字段，在该字段下的每个子字段分别有相应的作用和意义，再来就是自定义字段，在json中会和aps同一级别目录下展示，这个是开发者自己知道的字段，在客户端自行解析和提取使用。"><span class="toc-number">6.0.0.0.1.</span> <span class="toc-text">消息json中的aps字段一看就知道是apple推送到设备之后的专属识别字段，在该字段下的每个子字段分别有相应的作用和意义，再来就是自定义字段，在json中会和aps同一级别目录下展示，这个是开发者自己知道的字段，在客户端自行解析和提取使用。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#结语"><span class="toc-number">7.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="post-content"><p>这篇文章费了我好多心血啊，这都是在我测试了一堆失败的代码，看了大量的博客之后，把其中最有用，最精华的部分提取出来的集成，也是我艰辛的踩坑历程，满满的干货啊！可能是我太渣了，这些东西以前都没接触过，所以下面会有很多很基础的东西，大神切莫见怪。。。</p>
<h1 id="HTTP-2"><a href="#HTTP-2" class="headerlink" title="HTTP/2"></a>HTTP/2</h1><blockquote>
<ul>
<li>HTTP/2扫盲：<a href="http://www.cnblogs.com/yingsmirk/p/5248506.html" target="_blank" rel="external">http://www.cnblogs.com/yingsmirk/p/5248506.html</a></li>
<li>HTTP/2官网文档：<a href="https://http2.github.io/" target="_blank" rel="external">https://http2.github.io/</a></li>
<li>HTTP/2标准文档中英文对照：<a href="https://github.com/fex-team/http2-spec" target="_blank" rel="external">https://github.com/fex-team/http2-spec</a></li>
<li>Wireshark抓包教程：<a href="http://fangxin.blog.51cto.com/1125131/735178" target="_blank" rel="external">http://fangxin.blog.51cto.com/1125131/735178</a></li>
<li><p>HTTP/2 大神汇总博客：<a href="https://imququ.com/post/http2-resource.html" target="_blank" rel="external">https://imququ.com/post/http2-resource.html</a></p>
</li>
<li><p>看过这些之后，应该对http/2协议有了一些最初的了解，知道大体是怎么回事，其实和http1/1差不多，区别点主要是以下几点：</p>
<blockquote>
<ol>
<li>二进制分帧：每个请求分成多个帧进行传送，都送到之后再进行拼装</li>
<li>多路复用：二进制分帧之后的一个好处，多个请求共享同一个tcp连接，节约连接数量，提高连接利用率</li>
<li>服务器推送：推测客户端之后可能要的数据提前推送</li>
<li>头部压缩：两端各维护一个头部表，每次请求只传送头部不同的部分，减少传输冗余资源</li>
<li>ALPN应用层协议协商：和http1/1的兼容协商机制，这个下面会有关于java的相关说明</li>
<li>支持异步编程，非阻塞，提高效率</li>
</ol>
</blockquote>
</li>
<li>看了这些算是了解一些大概吧，很多东西到了实际使用中再来慢慢体会</li>
</ul>
</blockquote>
<h1 id="OkHttp学习和使用"><a href="#OkHttp学习和使用" class="headerlink" title="OkHttp学习和使用"></a>OkHttp学习和使用</h1><blockquote>
<p>这东西好久之前就用过，这次算是复习和提升以下，以前就是当个http客户端模拟使用，没处理过cookie、证书什么的，这次由于下面要做的事情的需要，就做了这些测试：</p>
<ul>
<li>okhttp教程：<a href="http://gold.xitu.io/entry/5728441d128fe1006058b6b9" target="_blank" rel="external">http://gold.xitu.io/entry/5728441d128fe1006058b6b9</a></li>
<li>OkHttp使用进阶 译自OkHttp Github官方教程：<a href="http://www.cnblogs.com/ct2011/p/3997368.html" target="_blank" rel="external">http://www.cnblogs.com/ct2011/p/3997368.html</a></li>
<li><p>OkHttp使用完全教程：<a href="http://www.jianshu.com/p/ca8a982a116b" target="_blank" rel="external">http://www.jianshu.com/p/ca8a982a116b</a></p>
</li>
<li><p>okhttp APNs：<a href="https://segmentfault.com/a/1190000005060740" target="_blank" rel="external">https://segmentfault.com/a/1190000005060740</a></p>
</li>
<li>okhttp https:<a href="http://blog.csdn.net/lmj623565791/article/details/48129405" target="_blank" rel="external">http://blog.csdn.net/lmj623565791/article/details/48129405</a><br><a href="http://www.itdadao.com/articles/c15a693269p0.html" target="_blank" rel="external">http://www.itdadao.com/articles/c15a693269p0.html</a></li>
</ul>
<p>用的很爽啊，链式编程、API设计易于理解、sample众多、直接搬砖。。。</p>
</blockquote>
<h1 id="APNs"><a href="#APNs" class="headerlink" title="APNs"></a>APNs</h1><p>github上找了很多项目来实验啊，最后还是Pushy这个最满意，也最实用，并且也由它又发现了新世界，开启新世界，新的征程开始~<br>先来点介绍文吧~ 这些介绍看完，相信你也对APNs新版的协议有了比较清楚的了解。</p>
<blockquote>
<ul>
<li>APNs官网文档：<a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1" target="_blank" rel="external">https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1</a></li>
<li>APNs简要介绍：基于HTTP2的全新APNs协议：<a href="https://github.com/ChenYilong/iOS9AdaptationTips" target="_blank" rel="external">https://github.com/ChenYilong/iOS9AdaptationTips</a></li>
<li><a href="https://github.com/ChenYilong/iOS9AdaptationTips/blob/master/%E5%9F%BA%E4%BA%8EHTTP2%E7%9A%84%E5%85%A8%E6%96%B0APNs%E5%8D%8F%E8%AE%AE/%E5%9F%BA%E4%BA%8EHTTP2%E7%9A%84%E5%85%A8%E6%96%B0APNs%E5%8D%8F%E8%AE%AE.md" target="_blank" rel="external">https://github.com/ChenYilong/iOS9AdaptationTips/blob/master/%E5%9F%BA%E4%BA%8EHTTP2%E7%9A%84%E5%85%A8%E6%96%B0APNs%E5%8D%8F%E8%AE%AE/%E5%9F%BA%E4%BA%8EHTTP2%E7%9A%84%E5%85%A8%E6%96%B0APNs%E5%8D%8F%E8%AE%AE.md</a></li>
</ul>
</blockquote>
<p>Pushy神器来啦~下面的APNs调用都用这个项目来作为底层支撑。</p>
<blockquote>
<ul>
<li>Pushy开源项目：<a href="https://github.com/relayrides/pushy" target="_blank" rel="external">https://github.com/relayrides/pushy</a></li>
<li>Pushy官网：<a href="http://relayrides.github.io/pushy/" target="_blank" rel="external">http://relayrides.github.io/pushy/</a></li>
<li>Pushy文档：<a href="http://relayrides.github.io/pushy/apidocs/0.8/overview-summary.html" target="_blank" rel="external">http://relayrides.github.io/pushy/apidocs/0.8/overview-summary.html</a></li>
<li>Jetty ALPN配置：<a href="http://www.eclipse.org/jetty/documentation/current/alpn-chapter.html#alpn-starting" target="_blank" rel="external">http://www.eclipse.org/jetty/documentation/current/alpn-chapter.html#alpn-starting</a></li>
<li>alpn-boot依赖下载：<a href="http://mvnrepository.com/artifact/org.mortbay.jetty.alpn/alpn-boot" target="_blank" rel="external">http://mvnrepository.com/artifact/org.mortbay.jetty.alpn/alpn-boot</a></li>
</ul>
</blockquote>
<h1 id="额外收获"><a href="#额外收获" class="headerlink" title="额外收获"></a>额外收获</h1><blockquote>
<ul>
<li>Netty高性能之道：<a href="http://www.infoq.com/cn/articles/netty-high-performance" target="_blank" rel="external">http://www.infoq.com/cn/articles/netty-high-performance</a></li>
<li>Netty官网：<a href="http://netty.io/" target="_blank" rel="external">http://netty.io/</a></li>
<li>书：《Netty权威指南》</li>
</ul>
</blockquote>
<p>你可能会觉得上面的废话好多，好多东西好像不需要了解，直接使用Pushy就行了呗，其实我也不敢说上面那些东西是否真的对下面的有用，但是知道这些原理，对后面发生的异常才能心中有数，至少在我的踩坑过程中也是深有体会的，其实上面那些东西不是我一开始就都看完的，是在我踩坑的过程中一步步补充的，每个人的只是学习顺序也许有所不同，你可以根据自己的情况合理安排~<br>我之所以会事先看这些东西，原因也是因为http/2、APNs、IOS推送、TLS等这些东西我真的不是很了解，会有一种恐惧之心，算是我自己的一个知识补充吧，所以对于对这些知识掌握很好的大神其实上面那些基础是完全可以不看的~<br>下面开始开发：</p>
<h1 id="环境配置："><a href="#环境配置：" class="headerlink" title="环境配置："></a>环境配置：</h1><p>在Pushy的README.md中详细说明了Pushy所需的环境，我个人由于感激这篇文章在我踩坑过程中的作用，因此特别的把它翻译出来<a href="http://www.coselding.cn/article/2016/12/01/Pushy%E5%85%A5%E9%97%A8%E6%96%87%E6%A1%A3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/">Pushy README.md中文翻译本</a>。<br>因为Pushy本身依赖了其他类库，为了方便，也由于我是是使用Maven管理和构件项目，我下面的教程完全都在Maven下进行部署和开发，请悉知：</p>
<h2 id="环境说明："><a href="#环境说明：" class="headerlink" title="环境说明："></a>环境说明：</h2><blockquote>
<p>必须JDK7以上版本，这个<a href="http://www.coselding.cn/article/2016/12/01/Pushy%E5%85%A5%E9%97%A8%E6%96%87%E6%A1%A3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/">Pushy README.md中文翻译本</a>上面详细说明了。</p>
<ol>
<li>JDK8+Tomcat9 M11：部署成功</li>
<li>JDK7+Tomcat7：部署成功</li>
<li>JDK7+Tomcat9 M11：Tomcat启动失败，原因不明，我从Tomcat启动失败的报错中认为可能是Tomcat9 M11中调用了JDK8中特有的API，导致在JDK7中启动失败。</li>
</ol>
<p>所以你部署环境的时候这个要注意，特别是部署到服务器当中的时候。</p>
</blockquote>
<h2 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h2><blockquote>
<ol>
<li><p>添加Pushy依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.relayrides<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pushy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加native SSL provider依赖，注意版本哦：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-tcnative-boringssl-static<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.33.Fork22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>这个是ALPN协议协商的实现依赖包，在<a href="http://www.coselding.cn/article/2016/12/01/Pushy%E5%85%A5%E9%97%A8%E6%96%87%E6%A1%A3%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/">Pushy README.md中文翻译本</a>有详细说明的。到这一步，你的普通Java程序就能跑起来向APNs服务器发起一个推送了~~</p>
<ol>
<li><p>添加alpn-boot依赖（Tomcat中所需）：<br>这一步和上面的不太一样，因为jar包需要添加到bootclasspath中，和普通的classpath不太一样，在JVM启动参数添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;`p:`后面的部分就是你下载下来的alpn-boot的jar包的本地地址，这个jar包的下载地址是这个[http://mvnrepository.com/artifact/org.mortbay.jetty.alpn/alpn-boot](http://mvnrepository.com/artifact/org.mortbay.jetty.alpn/alpn-boot)</div><div class="line">&gt;`原因：`</div><div class="line">&gt;&gt;1. 这种方式添加的jar包会替换JVM底层运行的相关API，你可以理解为加载优先级更高的jar，但是这种方式加载的jar是和平台相关的，所以你下载的jar包要选择和你平台相匹配的才行哦~~，当然，这里的这个jar其实已经是linux、win、macOS全平台都具有的了，它会根据平台加载相应的那个组件。</div><div class="line">&gt;&gt;2. 加载这个jar的理由是，我们上面加载的netty-tcnative-boringssl-static这个依赖，和Tomcat内部的tcnative实现相冲突了，所以要用这个jar包要进行适配，具体的底层原理这里不研究，你只要记住，如果你使用Tomcat，就要加上步骤3的这个依赖，Jetty实测不需要这个依赖。</div><div class="line"></div><div class="line">&gt;4. 添加从Apple开发者平台申请到的app证书文件到项目资源目录下</div><div class="line"></div><div class="line">&gt;5. 开始编码：创建ApnsClient对象实例：根据证书和证书密码创建和APNs服务器的连接对象</div><div class="line">```java</div><div class="line">ApnsClient apnsClient = new ApnsClientBuilder().setClientCredentials(new File(&quot;/path/to/p12-file&quot;), &quot;p12-file-password&quot;).build();</div></pre></td></tr></table></figure>
</li>
<li><p>等待和APNs的连接成功（HTTP/2是异步的，但是这里连接没成功后续步骤无法继续，所以需要等待）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Future&lt;Void&gt; connectFuture = apnsClient.connect(ApnsClient.PRODUCTION_APNS_HOST);</div><div class="line">        connectFuture.await();</div></pre></td></tr></table></figure>
</li>
</ol>
<p>链接地址有<code>DEVELOPMENT_APNS_HOST</code>和<code>PRODUCTION_APNS_HOST</code>两个，你要确认你拿到的证书是否支持开发者模式连接开发者服务器，我拿到的证书就是不支持的，需要直接连接正式服务器，这是我踩的坑。</p>
<ol>
<li>封装推送消息内容体：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ApnsPayloadBuilder payloadBuilder = <span class="keyword">new</span> ApnsPayloadBuilder();</div><div class="line">        payloadBuilder.setAlertBody(<span class="string">"alert-message-body"</span>);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>ApnsPayloadBuilder这个类可以好好看看，就是这个类封装推送消息体，携带了APNs推送能发送的各个字段，比如显示按钮、通知消息标题、消息体、图片名、消息声音文件名等，还由于APNs对每个消息最大长度限制为4K，因此还对过长的消息进行了智能化地截取工作。最后这这个类会被序列化为json串，就像如下的<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">   "aps" : &#123;</div><div class="line">      "category" : "NEW_MESSAGE_CATEGORY"</div><div class="line">      "alert" : &#123;</div><div class="line">         "body" : "Acme message received from Johnny Appleseed",</div><div class="line">      &#125;,</div><div class="line">      "badge" : 3,</div><div class="line">      "sound" : “chime.aiff"</div><div class="line">   &#125;,</div><div class="line">   "acme-account" : "jane.appleseed@apple.com",</div><div class="line">   "acme-message" : "message123456"</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果你要自己封装json也行，只要最后的json中有apple规定的那些键值就行，而额外的，你也可以自定义地添加一些自己业务所需的其他键值方便客户端接收到推送消息之后进行处理。</p>
<p>######智能截取4K长度：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String payload = payloadBuilder.buildWithDefaultMaximumLength();</div></pre></td></tr></table></figure></p>
<ol>
<li>封装消息体：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SimpleApnsPushNotification pushNotification = <span class="keyword">new</span> SimpleApnsPushNotification(token, <span class="string">"com.example.AppName"</span>, payload);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>其中token是每个设备生成的token串经过如下代码加工后得到的，相当于是设备的唯一id：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String token = TokenUtil.sanitizeTokenString(<span class="string">"&lt;device token&gt;"</span>);</div></pre></td></tr></table></figure></p>
<p>“com.example.AppName”:这个是你的证书签名，必须保证证书签名、证书、证书密码、产生token的app签名全部一致，不然就会报错。</p>
<h6 id="你的整个推送消息体封装好之后，在网络http-2传输过程中的最终传输的数据格式如下，主要包括headers和body-data："><a href="#你的整个推送消息体封装好之后，在网络http-2传输过程中的最终传输的数据格式如下，主要包括headers和body-data：" class="headerlink" title="你的整个推送消息体封装好之后，在网络http/2传输过程中的最终传输的数据格式如下，主要包括headers和body data："></a>你的整个推送消息体封装好之后，在网络http/2传输过程中的最终传输的数据格式如下，主要包括headers和body data：</h6><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">HEADERS</div><div class="line">  \- END_STREAM</div><div class="line">  \+ END_HEADERS</div><div class="line">  :method = POST</div><div class="line">  :scheme = https</div><div class="line">  :path = /<span class="number">3</span>/device/<span class="number">00f</span>c13adff785122b4ad28809a3420982341241421348097878e577c991de8f0</div><div class="line">  host = api.development.push.apple.com</div><div class="line">  apns-id = eabeae54-<span class="number">14</span>a8-<span class="number">11e5</span>-b60b-<span class="number">1697f</span>925ec7b</div><div class="line">  apns-expiration = <span class="number">0</span></div><div class="line">  apns-priority = <span class="number">10</span></div><div class="line">  apns-topic = &lt;MyAppTopic&gt; </div><div class="line">DATA</div><div class="line">  \+ END_STREAM</div><div class="line">    &#123; <span class="string">"aps"</span> : &#123; <span class="string">"alert"</span> : <span class="string">"Hello"</span> &#125; &#125;</div></pre></td></tr></table></figure>
</blockquote>
<ol>
<li>发送消息推送：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Future&lt;PushNotificationResponse&lt;SimpleApnsPushNotification&gt;&gt; sendNotificationFuture = apnsClient.sendNotification(pushNotification);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这是一个异步阻塞方法，调用之后推送通知会放到内部消息队列，等待APNs接收到消息并反馈的时候才能通过下面的方法得到响应，否则下面这个方法就会阻塞着，上线产品建议写成异步回调的方式：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PushNotificationResponse&lt;SimpleApnsPushNotification&gt; pushNotificationResponse = sendNotificationFuture.get();</div></pre></td></tr></table></figure></p>
<ol>
<li>接收APNs服务器响应：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pushNotificationResponse.isAccepted();</div></pre></td></tr></table></figure>
</li>
</ol>
<p>以下方法获取APNs服务器拒绝消息的相关响应信息：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pushNotificationResponse.getRejectionReason();<span class="comment">//获取拒绝原因</span></div><div class="line">pushNotificationResponse.getTokenInvalidationTimestamp();<span class="comment">//获取token失效时间</span></div></pre></td></tr></table></figure></p>
<ol>
<li><p>连接断开重连：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apnsClient.getReconnectionFuture().await();</div></pre></td></tr></table></figure>
</li>
<li><p>关闭连接，释放资源：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Future&lt;Void&gt; disconnectFuture = apnsClient.disconnect();</div><div class="line">disconnectFuture.await();</div></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>踩坑记录：Pushy项目中依赖了gson，如下：<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>如果你添加了如下的gson：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>那你的com.google的gson就会和Pushy中的gson冲突，然后出现未知的错误。。。知道就行，具体和这两个gson的差别有关，我没了解。。。这种坑也只有我这种人品的能踩到。。。最好是两个够不添加，反正Pushy在Maven中就会自动依赖引入了，何必多此一举。</p>
</blockquote>
<h1 id="消息包装实战"><a href="#消息包装实战" class="headerlink" title="消息包装实战"></a>消息包装实战</h1><p>我本人没接触过iOS开发，因此对这个消息体那些字段有些什么用不是搞得很清楚，只是大概知道图标、按钮显示、声音等意思，但是具体到iOS设备接收到之后会有什么样的消息体现，我不是很清楚，但是懂得的人看了下面我的测试样例，我相信也能很快包装出自己想要的消息~</p>
<h5 id="消息json中的aps字段一看就知道是apple推送到设备之后的专属识别字段，在该字段下的每个子字段分别有相应的作用和意义，再来就是自定义字段，在json中会和aps同一级别目录下展示，这个是开发者自己知道的字段，在客户端自行解析和提取使用。"><a href="#消息json中的aps字段一看就知道是apple推送到设备之后的专属识别字段，在该字段下的每个子字段分别有相应的作用和意义，再来就是自定义字段，在json中会和aps同一级别目录下展示，这个是开发者自己知道的字段，在客户端自行解析和提取使用。" class="headerlink" title="消息json中的aps字段一看就知道是apple推送到设备之后的专属识别字段，在该字段下的每个子字段分别有相应的作用和意义，再来就是自定义字段，在json中会和aps同一级别目录下展示，这个是开发者自己知道的字段，在客户端自行解析和提取使用。"></a>消息json中的<code>aps字段</code>一看就知道是apple推送到设备之后的专属识别字段，在该字段下的每个子字段分别有相应的作用和意义，再来就是<code>自定义字段</code>，在json中会和aps同一级别目录下展示，这个是开发者自己知道的字段，在客户端自行解析和提取使用。</h5><blockquote>
<ul>
<li><p>消息包装代码展示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">ApnsPayloadBuilder payloadBuilder = <span class="keyword">new</span> ApnsPayloadBuilder();</div><div class="line"><span class="comment">//体现在aps的category字段</span></div><div class="line">payloadBuilder.setCategoryName(<span class="string">"category"</span>);</div><div class="line"><span class="comment">//体现在aps的content-available字段</span></div><div class="line">payloadBuilder.setContentAvailable(<span class="keyword">true</span>);</div><div class="line"><span class="comment">//弹出窗消息图标，aps的alert字段的launch-image字段</span></div><div class="line">payloadBuilder.setLaunchImageFileName(<span class="string">"icon.icon"</span>);</div><div class="line"><span class="comment">//以下为两种弹出窗的消息封装模式</span></div><div class="line"><span class="comment">//弹出窗消息封装1</span></div><div class="line">payloadBuilder.setAlertBody(<span class="string">"Example!"</span>);<span class="comment">//aps的alert字段的body字段</span></div><div class="line">payloadBuilder.setAlertSubtitle(<span class="string">"AlertSubtitle"</span>);<span class="comment">//aps的alert字段的title字段</span></div><div class="line">payloadBuilder.setAlertTitle(<span class="string">"AlertTitle"</span>);<span class="comment">//aps的alert字段的subtitle字段</span></div><div class="line"><span class="comment">//弹出窗消息封装2</span></div><div class="line">payloadBuilder.setLocalizedActionButtonKey(<span class="string">"LocalizedActionButtonKey"</span>);<span class="comment">//aps的alert字段的action-loc-key字段</span></div><div class="line">payloadBuilder.setLocalizedAlertMessage(<span class="string">"LocalizedAlertMessage"</span>);<span class="comment">//aps的alert字段的loc-key字段</span></div><div class="line">payloadBuilder.setLocalizedAlertSubtitle(<span class="string">"LocalizedAlertSubtitle"</span>);<span class="comment">//aps的alert字段的subtitle-loc-key字段</span></div><div class="line">payloadBuilder.setLocalizedAlertTitle(<span class="string">"LocalizedAlertTitle"</span>);<span class="comment">//aps的alert字段的title-loc-key字段</span></div><div class="line"><span class="comment">//消息通知声音，aps的sound字段</span></div><div class="line">payloadBuilder.setSoundFileName(<span class="string">"sound.wav"</span>);</div><div class="line"><span class="comment">//aps的badge字段</span></div><div class="line">payloadBuilder.setBadgeNumber(<span class="number">1</span>);</div><div class="line"><span class="comment">//aps的mutable-content字段</span></div><div class="line">payloadBuilder.setMutableContent(<span class="keyword">true</span>);</div><div class="line"><span class="comment">//自定义键值对，其中value是Object，可以支持多层的json字串，这个根据业务需求而定</span></div><div class="line">payloadBuilder.addCustomProperty(<span class="string">"name"</span>,<span class="string">"value"</span>);</div><div class="line"><span class="comment">//是否显示动作按钮，这个没在json中体现啊，可能在header中体现吧，没研究</span></div><div class="line">payloadBuilder.setShowActionButton(<span class="keyword">true</span>);</div><div class="line">String payload = payloadBuilder.buildWithDefaultMaximumLength();</div><div class="line">String token = TokenUtil.sanitizeTokenString(<span class="string">"aa1e3286fcf87a68f9e8be642d9661c4a4537e34fe4abab68a9681ced773c18f"</span>);</div><div class="line">System.out.println(<span class="string">"payload = "</span> + payload);</div><div class="line">System.out.println(<span class="string">"token = "</span> + token);</div><div class="line">SimpleApnsPushNotification pushNotification = <span class="keyword">new</span> SimpleApnsPushNotification(token, <span class="string">"cn.geili.KoudaiGouwu"</span>, payload);</div><div class="line">System.out.println(pushNotification.toString());</div></pre></td></tr></table></figure>
</li>
<li><p>其中弹出窗消息封装有两种，如下所示</p>
</li>
<li><p>弹出窗消息封装1，json展示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"aps"</span>: &#123;</div><div class="line">        <span class="string">"category"</span>: <span class="string">"category"</span>,</div><div class="line">        <span class="string">"content-available"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"alert"</span>: &#123;</div><div class="line">            <span class="string">"body"</span>: <span class="string">"Example!"</span>,</div><div class="line">            <span class="string">"launch-image"</span>: <span class="string">"icon.icon"</span>,</div><div class="line">            <span class="string">"title"</span>: <span class="string">"AlertTitle"</span>,</div><div class="line">            <span class="string">"subtitle"</span>: <span class="string">"AlertSubtitle"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"sound"</span>: <span class="string">"sound.wav"</span>,</div><div class="line">        <span class="string">"badge"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"mutable-content"</span>: <span class="number">1</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"name"</span>: <span class="string">"value"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>弹出窗消息封装2，json展示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"aps"</span>: &#123;</div><div class="line">        <span class="string">"category"</span>: <span class="string">"category"</span>,</div><div class="line">        <span class="string">"content-available"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"alert"</span>: &#123;</div><div class="line">            <span class="string">"launch-image"</span>: <span class="string">"icon.icon"</span>,</div><div class="line">            <span class="string">"action-loc-key"</span>: <span class="string">"LocalizedActionButtonKey"</span>,</div><div class="line">            <span class="string">"loc-key"</span>: <span class="string">"LocalizedAlertMessage"</span>,</div><div class="line">            <span class="string">"subtitle-loc-key"</span>: <span class="string">"LocalizedAlertSubtitle"</span>,</div><div class="line">            <span class="string">"title-loc-key"</span>: <span class="string">"LocalizedAlertTitle"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"sound"</span>: <span class="string">"sound.wav"</span>,</div><div class="line">        <span class="string">"badge"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"mutable-content"</span>: <span class="number">1</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"name"</span>: <span class="string">"value"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>教程完结，有了这个教程，差不多就可以在生产环境中部署新版的APNs推送服务了，你只需要将以上的教程代码进行相应的封装，根据业务场景对消息体json也进行相应的封装，剩余的事情都交给这个Pushy框架即可，内部对消息队列、失败重传等都进行了处理，不过为了更好地开发出高性能高并发的推送服务器，最好还是对内部原理深入理解，特别是Netty内部细节（这个可是Pushy底层的网络支持和IO框架）。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.coselding.cn/2016/12/01/APNs入门学习和使用/" data-id="cj74spwye00018y50p586e5w6" class="article-share-link">分享</a><div class="tags"><a href="/tags/pushy/">pushy</a><a href="/tags/APNs/">APNs</a><a href="/tags/IOS/">IOS</a><a href="/tags/http-2/">http/2</a></div><div class="post-nav"><a href="/2016/12/21/Pushy入门文档中文翻译/" class="pre">Pushy入门文档中文翻译</a><a href="/2016/11/17/macOS入门认识与折腾/" class="next">macOS入门认识与折腾</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script>var cloudTieConfig = {
  url: document.location.href,
  productKey: "8c4e8416431747c595ded338559ffe2e",
  target: "cloud-tie-wrapper"
};</script><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/03/JStorm实时计算框架学习 —— 博客/">JStorm实时计算框架学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/25/Solr6.5.1集群部署和后台管理/">Solr 6.5.1集群部署和后台管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/maven多套环境配置文件和junit冲突问题解决方案/">maven多套环境配置文件和junit冲突问题解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/Quartz调度系统入门和调度高可用实现方案/">Quartz调度系统入门和调度高可用实现方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/Swagger-maven-plugin-环境配置踩坑记录/">Swagger-maven-plugin-环境配置踩坑记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/记毕设过程中遇到的一个InnoDB的坑/">记毕设过程中遇到的一个InnoDB的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/12/知识、任务管理软件个人测评/">知识、任务管理软件个人测评</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/Dubbo入门学习笔记/">Dubbo入门学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/ZooKeeper配置和学习笔记/">ZooKeeper配置和学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/21/Pushy入门文档中文翻译/">Pushy入门文档中文翻译</a></li></ul></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/个人心得/">个人心得</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/实时计算/">实时计算</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/">微服务</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/推送/">推送</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/pushy/" style="font-size: 15px;">pushy</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/http-2/" style="font-size: 15px;">http/2</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/RPC/" style="font-size: 15px;">RPC</a> <a href="/tags/Dubbo/" style="font-size: 15px;">Dubbo</a> <a href="/tags/SOA/" style="font-size: 15px;">SOA</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/实时计算/" style="font-size: 15px;">实时计算</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/JStorm/" style="font-size: 15px;">JStorm</a> <a href="/tags/流式计算/" style="font-size: 15px;">流式计算</a> <a href="/tags/调度/" style="font-size: 15px;">调度</a> <a href="/tags/quartz/" style="font-size: 15px;">quartz</a> <a href="/tags/分布式调度/" style="font-size: 15px;">分布式调度</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/Swagger/" style="font-size: 15px;">Swagger</a> <a href="/tags/自动化/" style="font-size: 15px;">自动化</a> <a href="/tags/RESTful/" style="font-size: 15px;">RESTful</a> <a href="/tags/APNs/" style="font-size: 15px;">APNs</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/折腾/" style="font-size: 15px;">折腾</a> <a href="/tags/环境搭建/" style="font-size: 15px;">环境搭建</a> <a href="/tags/mac实用插件/" style="font-size: 15px;">mac实用插件</a> <a href="/tags/集群管理/" style="font-size: 15px;">集群管理</a> <a href="/tags/选举/" style="font-size: 15px;">选举</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/junit/" style="font-size: 15px;">junit</a> <a href="/tags/filter/" style="font-size: 15px;">filter</a> <a href="/tags/spring-test/" style="font-size: 15px;">spring-test</a> <a href="/tags/经验/" style="font-size: 15px;">经验</a> <a href="/tags/面试/" style="font-size: 15px;">面试</a> <a href="/tags/校招/" style="font-size: 15px;">校招</a> <a href="/tags/时间管理/" style="font-size: 15px;">时间管理</a> <a href="/tags/知识管理/" style="font-size: 15px;">知识管理</a> <a href="/tags/doit-im/" style="font-size: 15px;">doit.im</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/InnoDB/" style="font-size: 15px;">InnoDB</a> <a href="/tags/读写锁/" style="font-size: 15px;">读写锁</a> <a href="/tags/事务/" style="font-size: 15px;">事务</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.zning.net.cn" title="张宁网" target="_blank">张宁网</a><ul></ul><a href="https://cloudups.github.io" title="凌云阁" target="_blank">凌云阁</a><ul></ul><a href="https://noahzu.github.io" title="Android资源开发小栈" target="_blank">Android资源开发小栈</a><ul></ul><a href="https://heinika.github.io/" title="陈利津" target="_blank">陈利津</a><ul></ul><a href="http://www.itfenghui.com/" title="SEO" target="_blank">SEO</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Coselding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?abf89816d80a3915fe058fcbceeaa9b9";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>