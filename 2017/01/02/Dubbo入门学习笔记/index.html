<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Java、分布式、大数据、微服务、机器学习"><title>Dubbo入门学习笔记 | Coselding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Dubbo入门学习笔记</h1><a id="logo" href="/.">Coselding</a><p class="description">非淡泊无以明志，非宁静无以致远。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/timeline/"><i class="fa fa-hourglass-start"> 时间轴</i></a><a href="/old/"><i class="fa fa-link"> 以前</i></a><a href="/about/"><i class="fa fa-user"> 关于我</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Dubbo入门学习笔记</h1><div class="post-meta">Jan 2, 2017<span> | </span><span class="category"><a href="/categories/微服务/">微服务</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a href="/2017/01/02/Dubbo入门学习笔记/#comments" class="ds-thread-count cloud-tie-join-count"><span style="font-size: 15px; color: #6E7173;" class="join-count">0</span><span> 条参与</span></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo是什么"><span class="toc-number">1.</span> <span class="toc-text">Dubbo是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一些参考站点或博客"><span class="toc-number">2.</span> <span class="toc-text">一些参考站点或博客</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#注意"><span class="toc-number">2.1.</span> <span class="toc-text"> 注意 </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo环境准备"><span class="toc-number">3.</span> <span class="toc-text">Dubbo环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo注册中心"><span class="toc-number">4.</span> <span class="toc-text">Dubbo注册中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo样例服务开发"><span class="toc-number">5.</span> <span class="toc-text">Dubbo样例服务开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo简单监控中心"><span class="toc-number">6.</span> <span class="toc-text">Dubbo简单监控中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo管理后台使用"><span class="toc-number">7.</span> <span class="toc-text">Dubbo管理后台使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务路由"><span class="toc-number">8.</span> <span class="toc-text">服务路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#负载均衡"><span class="toc-number">9.</span> <span class="toc-text">负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo过滤器"><span class="toc-number">10.</span> <span class="toc-text">Dubbo过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dubbo-Rest风格服务"><span class="toc-number"></span> <span class="toc-text">Dubbo Rest风格服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#还欠缺安全保护和集群性能调优方面的讲解，毕竟才刚入门，待我在公司的项目中使用一段时间有了真正的一些实战感悟再来好好总结"><span class="toc-number">0.1.</span> <span class="toc-text">还欠缺安全保护和集群性能调优方面的讲解，毕竟才刚入门，待我在公司的项目中使用一段时间有了真正的一些实战感悟再来好好总结~</span></a></li></ol></li></ol></div></div><div class="post-content"><h3 id="Dubbo是什么"><a href="#Dubbo是什么" class="headerlink" title="Dubbo是什么"></a>Dubbo是什么</h3><p>Dubbo是Alibaba开源的分布式服务框架，它最大的特点是按照分层的方式来架构，使用这种方式可以使各个层之间解耦合（或者最大限度地松耦合）。从服务模型的角度来看，Dubbo采用的是一种非常简单的模型，要么是提供方提供服务，要么是消费方消费服务，所以基于这一点可以抽象出服务提供方（Provider）和服务消费方（Consumer）两个角色。<br>简单说呢，Dubbo用起来就和EJB、WebService差不多，调用一个远程的服务（或者JavaBean）的时候在本地有一个接口，就像调用本地的方法一样去调用，它底层帮你实现好你的方法参数传输和远程服务运行结果传回之后的返回，就是RPC的一种封装啦~<br>当然，这个只是Dubbo的最基本的功能，它的特点是：</p>
<ol>
<li>它主要是使用高效的网络框架和序列化框架，让分布式服务之间调用效率更高。</li>
<li>采用<code>注册中心</code>管理众多的服务接口地址，当你想调用服务的时候只需要跟注册中心询问即可，不用像使用WebService一样每个服务都得记录好接口调用方式。</li>
<li><code>监控中心</code>：实现对服务方和调用方之间运行状态的监控，还能控制服务的优先级、权限、权重、上下线等，让整个庞大的分布式服务系统的维护和治理比较方便。</li>
<li>高可用：有个服务宕机了？注册中心就会从服务列表去掉该节点。还是调用到了？客户端会向注册中心请求另一台可用的服务节点重新调用。注册中心宕机？注册中心也能实现高可用（ZooKeeper）。</li>
<li>负载均衡：采用软负载均衡算法实现对多个相同服务的节点的请求负载均衡。</li>
<li>等等。。。很多高大上的，看官方文档吧，我也是文档中抄过来的~</li>
</ol>
<h3 id="一些参考站点或博客"><a href="#一些参考站点或博客" class="headerlink" title="一些参考站点或博客"></a>一些参考站点或博客</h3><blockquote>
<ul>
<li>官方用户指南：<a href="http://dubbo.io/User+Guide-zh.htm" target="_blank" rel="external">http://dubbo.io/User+Guide-zh.htm</a></li>
<li>官网(还有挺多东西，不一一列出了，自己点点就有)：<a href="http://dubbo.io/" target="_blank" rel="external">http://dubbo.io/</a></li>
<li>Dubbo开源地址：<a href="https://github.com/alibaba/dubbo/" target="_blank" rel="external">https://github.com/alibaba/dubbo/</a></li>
<li>Dubbo另一开源地址：<a href="https://github.com/dubbo/" target="_blank" rel="external">https://github.com/dubbo/</a><br>主要包括了Alibaba的Dubbo项目和当当网拓展之后的Dubbox项目，以及一些其他子项目和工具的代码，可以作为参考。</li>
<li>Dubbo架构设计详解：<a href="http://shiyanjun.cn/archives/325.html" target="_blank" rel="external">http://shiyanjun.cn/archives/325.html</a><br>一开始会有很多看不懂的，很正常，先整体过一遍，了解大致情况，等学的比较清楚了，再看一遍，会有额外收获，温故而知新，可以为师矣。</li>
<li>一个很详细的Dubbo学习笔记博客：<a href="http://blog.csdn.net/lipslive/article/details/46530361" target="_blank" rel="external">http://blog.csdn.net/lipslive/article/details/46530361</a></li>
<li>软负载均衡算法：<a href="http://www.cnblogs.com/xrq730/p/5154340.html" target="_blank" rel="external">http://www.cnblogs.com/xrq730/p/5154340.html</a></li>
</ul>
</blockquote>
<h4 id="注意"><a href="#注意" class="headerlink" title=" 注意 "></a><strong><em> 注意 </em></strong></h4><p>所有东西以官方用户指南为准：<a href="http://dubbo.io/User+Guide-zh.htm" target="_blank" rel="external">http://dubbo.io/User+Guide-zh.htm</a><br>其他第三方文章博客什么的可以参考辅助理解，但是由于阿里是国内公司，官方用户指南，特别是中文版都特别详细，真的没有很多必要去找一堆第三方的教程来看啦~</p>
<h3 id="Dubbo环境准备"><a href="#Dubbo环境准备" class="headerlink" title="Dubbo环境准备"></a>Dubbo环境准备</h3><p>Dubbo需要四大基本组件：Registry、Monitor、Provider、Consumer。<br><img src="http://upload-images.jianshu.io/upload_images/3932187-361ecb2025073656.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dubbo-architecture.jpg-version=1&amp;modificationDate=1330892870000.jpg"></p>
<ol>
<li><p>安装<strong>注册中心</strong>（Registry），我用ZooKeeper，具体参考我的<a href="http://www.jianshu.com/p/5e012efb2d82" target="_blank" rel="external">ZooKeeper教程博客</a>，安装好ZooKeeper之后注册中心就有了，先放着，等会用。</p>
</li>
<li><p>安装<strong>简单监控中心</strong>：simple-monitor。网上找<code>dubbo-monitor-simple-2.8.4-assembly.tar.gz</code>。</p>
<blockquote>
<ul>
<li>解压，找到conf文件夹下的dubbo.properties文件，下面简单介绍各个配置参数的意义：<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 容器，就是说这个简单监控中心是在jetty和spring环境下运行的，依赖于注册中心，日志系统是log4j</span></div><div class="line">dubbo.container=<span class="built_in">log</span>4j,spring,registry,jetty</div><div class="line"><span class="comment"># 监控系统对整个Dubbo服务系统来说也是一个服务，这里指定了这个监控服务的名称</span></div><div class="line">dubbo.application.name=simple-monitor</div><div class="line"><span class="comment"># 服务的所有者，这是Dubbo的服务的功能，可以指定服务的负责人</span></div><div class="line">dubbo.application.owner=coselding</div><div class="line"><span class="comment"># 下面四个是指定注册中心地址的，分别为广播、zookeeper、redis、dubbo（自带）方式的注册中心，前面说了，我用的是Zookeeper（前面配好了），因此去掉zookeeper前面的#，配置zookeeper的ip和端口号。之后简单监控中心就能通过注册中心获取当前可用的服务列表及其状态，在页面向你汇报Dubbo中的服务运行情况。</span></div><div class="line"><span class="comment">#dubbo.registry.address=multicast://224.5.6.7:1234</span></div><div class="line">dubbo.registry.address=zookeeper://&#123;ip&#125;:&#123;port&#125;</div><div class="line"><span class="comment">#dubbo.registry.address=redis://127.0.0.1:6379</span></div><div class="line"><span class="comment">#dubbo.registry.address=dubbo://127.0.0.1:9090</span></div><div class="line"><span class="comment"># dubbo协议端口号，保持默认即可</span></div><div class="line">dubbo.protocol.port=7070</div><div class="line"><span class="comment"># jetty工作端口号，平时不是习惯8080吗？当然，这里为了不影响之后运行的tomcat，就不要占用8080端口啦。</span></div><div class="line">dubbo.jetty.port=8082</div><div class="line"><span class="comment"># 一个工作目录，在这个目录会保存一些监控中心的数据，比如调用曲线图等，这里指定一个存在的空目录即可</span></div><div class="line">dubbo.jetty.directory=<span class="variable">$&#123;user.home&#125;</span>/monitor</div><div class="line"><span class="comment"># 监控中心报表存放的目录，同上，一般默认即可</span></div><div class="line">dubbo.charts.directory=<span class="variable">$&#123;dubbo.jetty.directory&#125;</span>/charts</div><div class="line"><span class="comment"># 监控中心数据资料目录，同上，一般默认即可</span></div><div class="line">dubbo.statistics.directory=<span class="variable">$&#123;user.home&#125;</span>/monitor/statistics</div><div class="line"><span class="comment"># 监控中心日志文件路径</span></div><div class="line">dubbo.log4j.file=logs/dubbo-monitor-simple.log</div><div class="line"><span class="comment"># 监控中心日志记录级别</span></div><div class="line">dubbo.log4j.level=WARN</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
</ol>
<blockquote>
<ul>
<li>运行bin目录下的start.sh（unix系下）或start.bat（win下）即可。</li>
<li>浏览器访问：<code>http://{简单监控中心所在的主机ip}:8082</code>，端口号是刚才配置文件设置的8082，即可访问查看Dubbo服务集群中的应用和服务的简单情况。</li>
</ul>
</blockquote>
<ol>
<li>安装<strong>Dubbo管理控制台</strong>：<blockquote>
<ul>
<li>下载<code>dubbo-admin-2.8.4.war</code>，这个是Dubbo的管理控制台的webapp的war包，将其解压。</li>
<li>WEB-INF目录下的<code>dubbo.properties</code>文件配置Dubbo的信息，如下：<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 配置注册中心地址，和简单监控中心一样，通过注册中心才能监控当前所有可用的服务。</span></div><div class="line">dubbo.registry.address=zookeeper://127.0.0.1:2181</div><div class="line"><span class="comment"># root账户的密码，网页进入控制台界面之前需要输入帐号密码</span></div><div class="line">dubbo.admin.root.password=root</div><div class="line"><span class="comment"># guest访客账户的密码</span></div><div class="line">dubbo.admin.guest.password=guest</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
</ol>
<blockquote>
<ul>
<li>将修改完配置的dubbo-admin的整个目录复制到tomcat的webapps目录下，重启tomcat，说白了dubbo-admin就是tomcat的一个webapp的形式存在。</li>
</ul>
</blockquote>
<h3 id="Dubbo注册中心"><a href="#Dubbo注册中心" class="headerlink" title="Dubbo注册中心"></a>Dubbo注册中心</h3><p>上面已经安装完成了zookeeper的注册中心了，这个注册中心主要就是负责dubbo的所有服务地址列表维护，并且可以通过在ZooKeeper节点中设置相应的值来实现对这个服务的权重、优先级、是否可用、路由、权限等的控制。<br>你可以先记住，之后在Dubbo的管理控制台对服务的一堆治理策略设置和调整，实际上就是修改了注册中心中的服务对应的配置数据（即修改了zookeeper中服务对应的节点的配置数据）。<br>之后<code>Consumer</code>从注册中心请求到服务的数据时就能根据这些配置数据进行相应的治理配置参数的代码执行生效。</p>
<h3 id="Dubbo样例服务开发"><a href="#Dubbo样例服务开发" class="headerlink" title="Dubbo样例服务开发"></a>Dubbo样例服务开发</h3><p>这里我用maven构建项目，在Spring环境中配置Provider和Consumer。<br>先说明使用的依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Spring所需依赖 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- dubbo所需依赖 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0.GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jboss.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>LATEST<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- ZooKeeper所需依赖 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ol>
<li><code>Provider</code>：<blockquote>
<ul>
<li>声明服务的接口：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMyDemo</span> </span>&#123;</div><div class="line">    	<span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
</ol>
<blockquote>
<ul>
<li><p>对接口进行实现（这里是Provider，需要真的实现，之后在Consumer端调用接口之后实际就是在这里的实现代码执行所需逻辑的）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDemo</span> <span class="keyword">implements</span> <span class="title">IMyDemo</span> </span>&#123;</div><div class="line">    	<span class="meta">@Override</span></div><div class="line">    	<span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        	String hello = <span class="string">"hello "</span> + name;</div><div class="line">        	System.out.println(hello);</div><div class="line">        	<span class="keyword">return</span> hello;</div><div class="line">    	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Spring配置相应的Dubbo服务(provider.xml)：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="comment">&lt;!-- 这里添加了dubbo的命名空间，之后Spring通过dubbo中扩展的配置解析生成对应的dubbo实例放到Spring的IoC容器中 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></div><div class="line">       http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       http://code.alibabatech.com/schema/dubbo</div><div class="line">       http://code.alibabatech.com/schema/dubbo/dubbo.xsd"&gt;</div><div class="line">    <span class="comment">&lt;!-- 指定服务的应用名称，在dubbo中层次级别是先分为多个应用（可以理解为一个项目），在每个应用下有多个服务（可以理解为项目下具体的某个提供服务的服务类） --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 这里就是指定一个应用的名称，指定相同的应用名的服务在dubbo中都会被分配在同一个应用分支下 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"hello-world-app"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 之前配置好的ZooKeeper服务器作为注册中心，这里指定好ZooKeeper的地址，此处的Dubbo才能连接上注册服务器，很好理解 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://119.29.153.56:2181"</span> <span class="attr">id</span>=<span class="string">"registry"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Dubbo的每个节点之间通信可以支持rmi、Http、Dubbo等一系列的协议，这里指定默认的dubbo协议，以及此处的服务Provider对外暴露的服务端口号 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 到这里，这个Provider节点就已经能连上注册服务器，并使用指定的协议进行通信了 --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 这里对外暴露刚才编写的接口，并指定IoC容器中接口的实现来为这个接口提供实际的服务 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.weidian.dubbo.IMyDemo"</span> <span class="attr">ref</span>=<span class="string">"myDemo"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 这里是Spring原始的JavaBean声明方式，并放在IoC容器中 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myDemo"</span> <span class="attr">class</span>=<span class="string">"com.weidian.dubbo.MyDemo"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>本地测试一下这个服务是否可用，这里还没用到Dubbo，只是先测试一下Spring容器是否有问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@org</span>.junit.<span class="function">Test</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDubbo</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">        ApplicationContext providerContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"provider.xml"</span>);</div><div class="line">        IMyDemo demo = providerContext.getBean(IMyDemo.class);</div><div class="line">        System.out.println(demo.sayHello(<span class="string">"world"</span>));</div><div class="line">        Thread.sleep(<span class="number">60000</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>运行结果：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-5deebe99b3ee816d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="provider.png"></p>
</li>
</ul>
<p>Provider内部代码输出了一遍，返回到测试代码又输出了一遍，总共两遍hello world</p>
<ol>
<li><code>Consumer</code>：</li>
</ol>
<ul>
<li><p>编写和Provider服务的对应接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMyDemo</span> </span>&#123;</div><div class="line">		<span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Spring配置远程的服务为本地的JavaBean（consumer.xml）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="comment">&lt;!-- 这里添加了dubbo的命名空间，之后Spring通过dubbo中扩展的配置解析生成对应的dubbo实例放到Spring的IoC容器中 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></div><div class="line">       http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       http://code.alibabatech.com/schema/dubbo</div><div class="line">        http://code.alibabatech.com/schema/dubbo/dubbo.xsd"&gt;</div><div class="line">    <span class="comment">&lt;!-- 声明要连接的应用名称，要和Provider声明的指定的应用名一致 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"hello-world-app"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 之前配置好的ZooKeeper服务器作为注册中心，这里指定好ZooKeeper的地址，此处的Dubbo才能连接上注册服务器，很好理解 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://119.29.153.56:2181"</span> <span class="attr">id</span>=<span class="string">"registry"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Dubbo的每个节点之间通信可以支持rmi、Http、Dubbo等一系列的协议，这里指定默认的dubbo协议，</span></div><div class="line">        以及此处的Consumer对外暴露的服务端口号，因为注册中心有服务节点列表更新是要实时推送到Consumer中的 </div><div class="line">        --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 到这里，这个Consumer节点就已经能连上注册服务器，并使用指定的协议进行通信了 --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 接口指定Consumer端的那个服务接口，之后它就会通过这个接口的应用名和全限定名去注册中心</span></div><div class="line">        查找实际的服务Provider地址列表，再通过指定的dubbo协议进行通信，实现RPC，而在Consumer</div><div class="line">        本机端对Spring的IoC容器指定id，方便之后对这个远程JavaBean的引用调用 --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoRemote"</span> <span class="attr">interface</span>=<span class="string">"com.weidian.dubbo.IMyDemo"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>另外，也能绕过Registry直连Provider，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.weidian.dubbo.IMyDemo"</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">id</span>=<span class="string">"myDemo"</span> <span class="attr">url</span>=<span class="string">"dubbo://127.0.0.1:20880/"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>远程过程调用测试(前提是先把Provider的服务先运行起来再来运行这个Consumer（在两个端的测试代码尾部都添加了sleep代码的原因）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@org</span>.junit.<span class="function">Test</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetRemoteService</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">        ApplicationContext consumerContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"consumer.xml"</span>);</div><div class="line">        IMyDemo demoRemote = consumerContext.getBean(IMyDemo.class);</div><div class="line">        System.out.println(demoRemote.sayHello(<span class="string">"world"</span>));</div><div class="line">        Thread.sleep(<span class="number">30000</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>运行结果：<br>Provider：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-9a802855fd5586a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="remote-provider.png"></p>
</li>
</ul>
<p>启动Provider输出了两遍，Consumer调用时本地实现又输出了一遍，共三遍。<br>Consumer：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-6794e25eaf0c0327.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="consumer.png"><br>启动Consumer，远程返回输出了一遍。</p>
</blockquote>
<h3 id="Dubbo简单监控中心"><a href="#Dubbo简单监控中心" class="headerlink" title="Dubbo简单监控中心"></a>Dubbo简单监控中心</h3><p>简单介绍，其实用处不大，我觉得管理后台的功能已经把这个监控中心的功能覆盖了，仅仅只是拿来测试使用一下。</p>
<blockquote>
<ul>
<li><p>主界面：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-c8de1b541c1094cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="simple-monitor.png"></p>
</li>
<li><p>服务列表界面，显示所有服务以及它的Provider和Consumer情况：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-4ab87c1e40a1f97a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="simple-monitor-Service.png"></p>
</li>
</ul>
</blockquote>
<h3 id="Dubbo管理后台使用"><a href="#Dubbo管理后台使用" class="headerlink" title="Dubbo管理后台使用"></a>Dubbo管理后台使用</h3><p>之前Tomcat中配置好了dubbo-admin的webapp，现在只要打开tomcat，并输入相应的地址即可访问dubbo-admin的界面，如我的是<code>http://127.0.0.1:8080/dubbo-admin/</code>。<br>其实就是一个很常见的管理后台，可以控制每个服务、应用的状态、权重、路由控制、访问控制、负载均衡、各个应用的服务情况和消费情况等，不需要教程，直接上手使用即可，至于其中的一些可能有疑问的概念，下面的内容将一一说明。</p>
<h3 id="服务路由"><a href="#服务路由" class="headerlink" title="服务路由"></a>服务路由</h3><p>路由，顾名思义，就是通过配置去设定哪些Consumer节点的请求由哪些节点的Provider节点的服务来进行响应，可以在一定程度上控制负载分布。<br>知道这个概念，那剩下就是配置的问题了，明白怎么回事其实就很简单啦~</p>
<p>在dubbo-admin<code>主界面</code>——<code>服务治理</code>——<code>路由规则</code>，如下：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-e8b493fedb3b993c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="router-main.png"></p>
<p>点击<code>新增</code>：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-9682cecfb9d34518.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="router-new.png"></p>
<p><code>路由名称</code>:为你定义的这个路由规则声明一个名称，之后可以根据这个名称来找这个路由规则。<br><code>优先级</code>:很明显，一个int数值代表这个路由规则的优先级，优先级越高这个规则越先匹配。<br><code>服务名</code>:列表选择的，从注册中心中已有的服务列表中选择一个服务，表示这个路由规则要约束的是哪个服务。<br><code>方法名</code>:列表选择的，选择要约束的这个服务中的哪个方法。<br><code>匹配条件</code>:填写<code>匹配</code>下面的列表就表示匹配了条件才受这个路由规则约束，否则就是不匹配规则才受该规则约束。<br><code>消费者IP地址</code>:要约束的Consumer的IP地址列表，逗号隔开。<br><code>消费者应用名</code>:要约束的Consumer的应用名列表。<br><code>消费者集群</code>:按照提示上写的去找，没找到相应的选项，暂时也没用到，之后再回头编辑。<br><code>过滤规则</code>:填写<code>匹配</code>下面的列表就表示匹配了条件才受这个路由规则约束，否则就是不匹配规则才受该规则约束。<br><code>提供者IP地址</code>:要约束的Provider的IP地址列表，逗号隔开。<br><code>提供者集群</code>:按照提示上写的去找，没找到相应的选项，暂时也没用到，之后再回头编辑。<br><code>提供者协议</code>:指定Provider的协议，不是该协议的也不约束。<br><code>提供者端口</code>:指定Provider的端口，不是这个端口的也不约束。</p>
<p>测试样例展示：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-109861dc573b0721.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="router-sample.png"></p>
<p>这样配置的路由就能够生效，效果是：<code>com.weidian.dubbo.IMyDemo</code>服务的<code>sayHello</code>方法下，地址为<code>192.168.31.164</code>的Consumer的请求由（地址：<code>192.168.31.164</code>；协议：<code>dubbo</code>；端口：<code>20880</code>）的Provider进行响应，如果没有匹配的Provider就会默认返回所有的Provider列表给Consumer，让Consumer自己选。<br>点击<code>保存</code>，保存新增的路由规则，并在路由规则列表中启用这个规则，如下：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-70b56949264cf927.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="router-list.png"></p>
<p>点击<code>预览</code>，在消费者地址填写192.168.31.164，点击预览，如下图所示：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-cf0c715ff0276f4e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="router-success.png"></p>
<p>运行Consumer程序，查看消费者状态，可知设定的这个路由规则对该对应地址的消费真生效了，如下图：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-02922d6c57c73d80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="router-consumer.png"></p>
<p>另外，IP地址支持结尾为<em>匹配所有，如10.0.0.</em>或者10.0.*等。<br>不匹配的配置规则和匹配的配置规则是一致的。</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>dubbo提供4种负载均衡方式:<br><code>Random</code>：随机，按权重配置随机概率，调用量越大分布越均匀，默认是这种方式<br><code>RoundRobin</code>：轮询，按权重设置轮询比例，如果存在比较慢的机器容易在这台机器的请求阻塞较多<br><code>LeastActive</code>：最少活跃调用数，不支持权重，只能根据自动识别的活跃数分配，不能灵活调配<br><code>ConsistentHash</code>：一致性hash，对相同参数的请求路由到一个服务提供者上，如果有类似灰度发布需求可采用<br>dubbo的负载均衡机制是在客户端调用时通过内存中的服务方信息及配置的负责均衡策略选择，如果对自己系统没有一个全面认知，建议先采用random方式。</p>
<blockquote>
<ul>
<li>软负载均衡算法：<a href="http://www.cnblogs.com/xrq730/p/5154340.html" target="_blank" rel="external">http://www.cnblogs.com/xrq730/p/5154340.html</a></li>
</ul>
</blockquote>
<h3 id="Dubbo过滤器"><a href="#Dubbo过滤器" class="headerlink" title="Dubbo过滤器"></a>Dubbo过滤器</h3><p>有需要自己实现dubbo过滤器的，可关注如下步骤：</p>
<ol>
<li><p>dubbo初始化过程加载ClassPath下的<code>META-INF/dubbo/internal/</code>，<code>META-INF/dubbo/</code>，<code>META-INF/services/</code>三个路径(classloader resource)下面的<code>com.alibaba.dubbo.rpc.Filter</code>文件。<br>文件内容：<br>每行<code>Name</code>=<code>FullClassName</code>，这些类必须是实现Filter接口，如下图：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-bc7e16a034a40ec9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="filter-prop.png"></p>
</li>
<li><p>自定义Filter类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.Constants;</div><div class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.extension.Activate;</div><div class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.*;</div><div class="line"><span class="comment">//激活这个过滤器的注解，标记这个过滤器在消费者端加入过滤器链</span></div><div class="line"><span class="meta">@Activate</span>(group = Constants.CONSUMER)</div><div class="line"><span class="comment">//dubbo过滤器的实现类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboTestFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</div><div class="line">    <span class="comment">/**计时器过滤器，记录这个RPC的整个过程执行时间</span></div><div class="line">     * <span class="doctag">@param</span> invoker</div><div class="line">     * <span class="doctag">@param</span> invocation</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     * <span class="doctag">@throws</span> RpcException</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>&#123;</div><div class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</div><div class="line">        <span class="comment">//这个是RPC的实现体，Result就是RPC的执行结果，和Servlet的过滤器有些类似</span></div><div class="line">        Result result = invoker.invoke(invocation);</div><div class="line">        System.out.println(<span class="string">"time = "</span> + (System.currentTimeMillis() - start) + <span class="string">"ms"</span>);</div><div class="line">        System.out.println(result.getValue());</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>consumer.xml配置文件中配置这个过滤器，如下图：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-f51971f7810ba245.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="filter-spring.png"></p>
</li>
<li><p>先来看看配置完成之后的执行效果：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-09de3a34c4ab619c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="filter-run.png"></p>
</li>
</ol>
<blockquote>
<p>对比上面的过滤器代码可知，先输出了RPC过程的运行时间，之后在过滤器中输出了一遍执行结果<code>hello world</code>，之后单元测试本身再把执行结果输出一遍，因此<code>hello world</code>输出了两遍。</p>
</blockquote>
<ol>
<li>Dubbo过于这个过滤器的加载过程：<blockquote>
<p>(1) 先加载那三个路径下的<code>com.alibaba.dubbo.rpc.Filter</code>文件里面的键值对，key为过滤器的名称，value为过滤器的类全限定名（这个类必须实现Dubbo中的Filter接口）；<br>(2) 这样就能找到这个类的class文件了，检查<code>@Activate</code>注解加载这个过滤器设定的一些全局基本属性；<br>(3) Spring在加载consumer.xml文件的时候，通过</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">filter</span>=<span class="string">"dubboTestFilter"</span> <span class="attr">id</span>=<span class="string">"dubboTestFilter"</span> <span class="attr">retries</span>=<span class="string">"0"</span>/&gt;</span></div></pre></td></tr></table></figure>
</blockquote>
</li>
</ol>
<p>指定消费者端要加载的过滤器，通过<code>filter</code>属性指定过滤器名称（就是配置文件中的过滤器key），这样刚才加载的过滤器类就加入消费者代码逻辑中的过滤器链了。</p>
<ol>
<li>关于<code>@Activate</code>注解： —— 自动激活<blockquote>
<p><code>group</code>：(provider|consumer）匹配了对应的角色才被加载<br><code>value</code>：标明过滤条件，不写则所有条件下都会被加载，写了则只有dubbo URL中包含该参数名且参数值不为空才被加载，这个参数会以dubbo协议的一个参数K-V对传到Provider。</p>
</blockquote>
</li>
</ol>
<h2 id="Dubbo-Rest风格服务"><a href="#Dubbo-Rest风格服务" class="headerlink" title="Dubbo Rest风格服务"></a>Dubbo Rest风格服务</h2><ol>
<li>当当Dubbox：<a href="https://dangdangdotcom.github.io/dubbox/rest.html" target="_blank" rel="external">https://dangdangdotcom.github.io/dubbox/rest.html</a></li>
<li>Dubbo Rest风格服务开发：<a href="https://segmentfault.com/a/1190000005170426" target="_blank" rel="external">https://segmentfault.com/a/1190000005170426</a></li>
</ol>
<hr>
<h4 id="还欠缺安全保护和集群性能调优方面的讲解，毕竟才刚入门，待我在公司的项目中使用一段时间有了真正的一些实战感悟再来好好总结"><a href="#还欠缺安全保护和集群性能调优方面的讲解，毕竟才刚入门，待我在公司的项目中使用一段时间有了真正的一些实战感悟再来好好总结" class="headerlink" title="还欠缺安全保护和集群性能调优方面的讲解，毕竟才刚入门，待我在公司的项目中使用一段时间有了真正的一些实战感悟再来好好总结~"></a>还欠缺安全保护和集群性能调优方面的讲解，毕竟才刚入门，待我在公司的项目中使用一段时间有了真正的一些实战感悟再来好好总结~</h4></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.coselding.cn/2017/01/02/Dubbo入门学习笔记/" data-id="cj74segmp0003vm50jntzu2e3" class="article-share-link">分享</a><div class="tags"><a href="/tags/Java/">Java</a><a href="/tags/RPC/">RPC</a><a href="/tags/Dubbo/">Dubbo</a><a href="/tags/SOA/">SOA</a><a href="/tags/分布式/">分布式</a></div><div class="post-nav"><a href="/2017/03/12/知识、任务管理软件个人测评/" class="pre">知识、任务管理软件个人测评</a><a href="/2017/01/02/ZooKeeper配置和学习笔记/" class="next">ZooKeeper配置和学习笔记</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script>var cloudTieConfig = {
  url: document.location.href,
  productKey: "8c4e8416431747c595ded338559ffe2e",
  target: "cloud-tie-wrapper"
};</script><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/03/JStorm实时计算框架学习 —— 博客/">JStorm实时计算框架学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/25/Solr6.5.1集群部署和后台管理/">Solr 6.5.1集群部署和后台管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/maven多套环境配置文件和junit冲突问题解决方案/">maven多套环境配置文件和junit冲突问题解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/Quartz调度系统入门和调度高可用实现方案/">Quartz调度系统入门和调度高可用实现方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/Swagger-maven-plugin-环境配置踩坑记录/">Swagger-maven-plugin-环境配置踩坑记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/记毕设过程中遇到的一个InnoDB的坑/">记毕设过程中遇到的一个InnoDB的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/12/知识、任务管理软件个人测评/">知识、任务管理软件个人测评</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/Dubbo入门学习笔记/">Dubbo入门学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/ZooKeeper配置和学习笔记/">ZooKeeper配置和学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/21/Pushy入门文档中文翻译/">Pushy入门文档中文翻译</a></li></ul></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/个人心得/">个人心得</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/实时计算/">实时计算</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/">微服务</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/推送/">推送</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/环境搭建/" style="font-size: 15px;">环境搭建</a> <a href="/tags/pushy/" style="font-size: 15px;">pushy</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/http-2/" style="font-size: 15px;">http/2</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/RPC/" style="font-size: 15px;">RPC</a> <a href="/tags/Dubbo/" style="font-size: 15px;">Dubbo</a> <a href="/tags/SOA/" style="font-size: 15px;">SOA</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/调度/" style="font-size: 15px;">调度</a> <a href="/tags/quartz/" style="font-size: 15px;">quartz</a> <a href="/tags/分布式调度/" style="font-size: 15px;">分布式调度</a> <a href="/tags/Swagger/" style="font-size: 15px;">Swagger</a> <a href="/tags/自动化/" style="font-size: 15px;">自动化</a> <a href="/tags/RESTful/" style="font-size: 15px;">RESTful</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/折腾/" style="font-size: 15px;">折腾</a> <a href="/tags/APNs/" style="font-size: 15px;">APNs</a> <a href="/tags/mac实用插件/" style="font-size: 15px;">mac实用插件</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/junit/" style="font-size: 15px;">junit</a> <a href="/tags/filter/" style="font-size: 15px;">filter</a> <a href="/tags/spring-test/" style="font-size: 15px;">spring-test</a> <a href="/tags/集群管理/" style="font-size: 15px;">集群管理</a> <a href="/tags/选举/" style="font-size: 15px;">选举</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/InnoDB/" style="font-size: 15px;">InnoDB</a> <a href="/tags/读写锁/" style="font-size: 15px;">读写锁</a> <a href="/tags/事务/" style="font-size: 15px;">事务</a> <a href="/tags/时间管理/" style="font-size: 15px;">时间管理</a> <a href="/tags/知识管理/" style="font-size: 15px;">知识管理</a> <a href="/tags/doit-im/" style="font-size: 15px;">doit.im</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/经验/" style="font-size: 15px;">经验</a> <a href="/tags/面试/" style="font-size: 15px;">面试</a> <a href="/tags/校招/" style="font-size: 15px;">校招</a> <a href="/tags/实时计算/" style="font-size: 15px;">实时计算</a> <a href="/tags/JStorm/" style="font-size: 15px;">JStorm</a> <a href="/tags/流式计算/" style="font-size: 15px;">流式计算</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.zning.net.cn" title="张宁网" target="_blank">张宁网</a><ul></ul><a href="https://cloudups.github.io" title="凌云阁" target="_blank">凌云阁</a><ul></ul><a href="https://noahzu.github.io" title="Android资源开发小栈" target="_blank">Android资源开发小栈</a><ul></ul><a href="https://heinika.github.io/" title="陈利津" target="_blank">陈利津</a><ul></ul><a href="http://www.itfenghui.com/" title="SEO" target="_blank">SEO</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Coselding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?abf89816d80a3915fe058fcbceeaa9b9";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>