<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Java、分布式、大数据、微服务、机器学习"><title>maven多套环境配置文件和junit冲突问题解决方案 | Coselding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">maven多套环境配置文件和junit冲突问题解决方案</h1><a id="logo" href="/.">Coselding</a><p class="description">非淡泊无以明志，非宁静无以致远。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/timeline/"><i class="fa fa-hourglass-start"> 时间轴</i></a><a href="/old/"><i class="fa fa-link"> 以前</i></a><a href="/about/"><i class="fa fa-user"> 关于我</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">maven多套环境配置文件和junit冲突问题解决方案</h1><div class="post-meta">May 4, 2017<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a href="/2017/05/04/maven多套环境配置文件和junit冲突问题解决方案/#comments" class="ds-thread-count cloud-tie-join-count"><span style="font-size: 15px; color: #6E7173;" class="join-count">0</span><span> 条参与</span></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#情景"><span class="toc-number">1.</span> <span class="toc-text">情景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这里简单说明一下多filter的情况："><span class="toc-number">2.</span> <span class="toc-text">这里简单说明一下多filter的情况：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局限性"><span class="toc-number">3.</span> <span class="toc-text">局限性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决方案"><span class="toc-number">4.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#结语"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="post-content"><h3 id="情景"><a href="#情景" class="headerlink" title="情景"></a>情景</h3><p>日常的企业级开发，开发一个项目往往需要配置多份的配置文件，比如开发需要一套、测试阶段需要一套、正式上线又有一套（比如JDBC连接的数据库，在不同环境肯定连接不同的库），但是maven给我们提供了filter功能可以很便捷地实现，关于maven的filter功能，不是重点，也实在太简单，需要的自行百度。。。</p>
<h3 id="这里简单说明一下多filter的情况："><a href="#这里简单说明一下多filter的情况：" class="headerlink" title="这里简单说明一下多filter的情况："></a>这里简单说明一下多filter的情况：</h3><ol>
<li><p>这里是多个filter配置文件，每个文件配置了对应环境下的jdbc连接配置：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-f3a567b8e32be19c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="maven-filters.png"></p>
</li>
<li><p>这里是项目配置文件，用${}的方式引用filter文件中的相应配置<br><img src="http://upload-images.jianshu.io/upload_images/3932187-cebfa246a0fd32e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="common.png"></p>
</li>
<li><p>接下来是maven配置文件<br><img src="http://upload-images.jianshu.io/upload_images/3932187-111783c444c3cc4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pom.png"><br><img src="http://upload-images.jianshu.io/upload_images/3932187-1bc0f75ee8b28285.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="profiles.png"></p>
</li>
</ol>
<ul>
<li>这样，maven在打包时，只需要指定相应的<code>mvn clean install -Ptest</code>这样的参数，就能直接指定对应的环境配置参数替换项目配置文件中的${}参数，达到动态替换配置的目的。</li>
</ul>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><ul>
<li><code>-Ptest</code>参数是在maven的<code>compile</code>生命周期时触发的，它会将对应环境的filter文件中参数替换掉项目resources目录下的<code>.xml</code>或者<code>.properties</code>配置文件中的${}包括的对应参数，只要你运行的代码触发可maven的compile周期，项目资源文件就能被正确替换，程序正确执行进行</li>
<li>但是！！！如果你只是简单地进行单元测试，如下所示：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-f9517c8a22682259.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="spring-junit.png"></li>
</ul>
<p>当你在<code>findById</code>上直接右键单元测试时，由于并没有触发maven的<code>compile</code>周期，导致<code>common.properties</code>文件中的<code>${jdbc.url}</code>系列的参数没有被替换，可想而知，这样的单元测试注定无法正确执行的。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li>临时把<code>common.properties</code>中的jdbc配置替换成当前所需环境的相应参数，等之后要部署上线记得回来重新把它改回去。</li>
<li>手动修改项目<code>target/classes</code>目录下的<code>common.properties</code>，这样的好处是，项目的源文件不会被修改，但是项目每次重新打包都得手动替换一次。</li>
</ol>
<ul>
<li>以上两种方案都不够优雅，有没有一劳永逸的方案呢？网上找了很多，没发现这方面的相应对策，然后我采取的方案是：右键单元测试的时候，在单元测试启动前插入一段代码，对target/classes中相应的资源文件进行替换，这样，在单元测试执行时加载的资源文件就是替换完成的了，程序正确执行~ </li>
<li>那如何在单元测试前插入代码呢？单元测试的启动是IDE有相应实现的（因为在idea中右键就直接启动了单元测试），但是天无绝人之路啊，我发现：<code>@RunWith(SpringJUnit4ClassRunner.class)</code>这个怎么看都像是单元测试的启动类，于是乎点开了它的源码，发现其中有两个带有before字样的method，如下：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-e4f5d621aeb57b1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="before-test-method.png"><br><img src="http://upload-images.jianshu.io/upload_images/3932187-e5af684d33fdc061.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="before-test-class.png"></li>
</ul>
<p>显而易见，应该是class之前执行参数替换喽~ 所以我就继承<code>SpringJUnit4ClassRunner</code>这个类，复写其<code>withBeforeClasses</code>方法，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 自定义SpringJUnit4ClassRunner，在Spring单元测试之前将maven的filter环境配置替换工程的配置文件，实现maven一键式单元测试的目的</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> linyuqiang</div><div class="line"> * <span class="doctag">@version</span> 1.0.0 2017/3/14</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WDSpringJUnit4ClassRunner</span> <span class="keyword">extends</span> <span class="title">SpringJUnit4ClassRunner</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WDSpringJUnit4ClassRunner</span><span class="params">(Class&lt;?&gt; clazz)</span> <span class="keyword">throws</span> InitializationError </span>&#123;</div><div class="line">        <span class="keyword">super</span>(clazz);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> Statement <span class="title">withBeforeClasses</span><span class="params">(Statement statement)</span> </span>&#123;</div><div class="line">        ConfigFilesCatcher configFilesCatcher = <span class="keyword">new</span> ConfigFilesCatcher(<span class="keyword">new</span> WDTestConfiguration());</div><div class="line">        <span class="comment">//获取filter文件</span></div><div class="line">        File filterFile = configFilesCatcher.getFilterFile();</div><div class="line">        FileInputStream fis = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            fis = <span class="keyword">new</span> FileInputStream(filterFile);</div><div class="line">            Properties properties = <span class="keyword">new</span> Properties();</div><div class="line">            <span class="comment">//filter中的键值对</span></div><div class="line">            properties.load(fis);</div><div class="line"></div><div class="line">            <span class="comment">//遍历类路径下的所有配置文件</span></div><div class="line">            List&lt;File&gt; classpathFiles = configFilesCatcher.getClasspathFiles();</div><div class="line">            <span class="keyword">for</span> (File file : classpathFiles) &#123;</div><div class="line">                FileInputStream is = <span class="keyword">null</span>;</div><div class="line">                FileOutputStream fos = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    is = <span class="keyword">new</span> FileInputStream(file);</div><div class="line">                    ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">                    IOUtils.copy(is, baos);</div><div class="line">                    <span class="comment">//将该配置文件中含有filter中的元素子串替换</span></div><div class="line">                    String content = <span class="keyword">new</span> String(baos.toByteArray());</div><div class="line">                    <span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : properties.entrySet()) &#123;</div><div class="line">                        String key = <span class="string">"$&#123;"</span> + entry.getKey() + <span class="string">"&#125;"</span>;</div><div class="line">                        <span class="keyword">if</span> (content.contains(key)) &#123;</div><div class="line">                            content = content.replace(key, (CharSequence) entry.getValue());</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">//配置文件替换完毕回写</span></div><div class="line">                    fos = <span class="keyword">new</span> FileOutputStream(file);</div><div class="line">                    fos.write(content.getBytes());</div><div class="line">                    logger.info(<span class="string">"&#123;&#125;文件配置替换成功"</span>, file.getName());</div><div class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                    logger.warn(<span class="string">"&#123;&#125; 文件的filter替换失败"</span>, file.getName());</div><div class="line">                    <span class="comment">//不影响下一个文件</span></div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                    closeIs(is);</div><div class="line">                    closeOs(fos);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            logger.warn(<span class="string">"filter文件不存在"</span>, e);</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"filter文件不存在"</span>,e);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            logger.warn(<span class="string">"filter文件加载失败"</span>, e);</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"filter文件加载失败"</span>,e);</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            closeIs(fis);</div><div class="line">        &#125;</div><div class="line">        logger.info(<span class="string">"filter文件配置替换完毕"</span>);</div><div class="line">        <span class="comment">//执行SpringJUnit4ClassRunner原本逻辑</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.withBeforeClasses(statement);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeIs</span><span class="params">(InputStream is)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                is.close();</div><div class="line">                is = <span class="keyword">null</span>;</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeOs</span><span class="params">(OutputStream os)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (os != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                os.close();</div><div class="line">                os = <span class="keyword">null</span>;</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后这是参数替换的逻辑：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 单元测试替换文件列表获取器</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> linyuqiang</div><div class="line"> * <span class="doctag">@version</span> 1.0.0 2017/3/14</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigFilesCatcher</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</div><div class="line">    <span class="keyword">private</span> WDTestConfiguration configuration;</div><div class="line">    <span class="keyword">private</span> String projectPath;<span class="comment">//项目绝对路径</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConfigFilesCatcher</span><span class="params">(WDTestConfiguration configuration)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.configuration = configuration;</div><div class="line">        <span class="keyword">this</span>.projectPath = getProjectPath();</div><div class="line">        logger.info(<span class="string">"文件获取器初始化成功，项目绝对路径为：&#123;&#125;"</span>, <span class="keyword">this</span>.projectPath);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取filter文件</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getFilterFile</span><span class="params">()</span> </span>&#123;</div><div class="line">        File file = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (configuration.isAbsolute()) &#123;</div><div class="line">            file = <span class="keyword">new</span> File(configuration.getFilterPath());</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            file = <span class="keyword">new</span> File(projectPath + <span class="string">"/src/main/filters/"</span> + configuration.getFilterFile());</div><div class="line">        &#125;</div><div class="line">        logger.info(<span class="string">"filter文件获取成功：&#123;&#125;"</span>, file.getAbsolutePath());</div><div class="line">        <span class="keyword">return</span> file;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getProjectPath</span><span class="params">()</span> </span>&#123;</div><div class="line">        File file = <span class="keyword">new</span> File(<span class="keyword">this</span>.getClass().getClassLoader().getResource(<span class="string">""</span>).getFile());</div><div class="line">        <span class="keyword">while</span> (file != <span class="keyword">null</span> &amp;&amp; file.getParentFile() != <span class="keyword">null</span> &amp;&amp; !file.getName().equals(<span class="string">"target"</span>)) &#123;</div><div class="line">            file = file.getParentFile();</div><div class="line">            <span class="keyword">if</span> (file.getName() != <span class="keyword">null</span> &amp;&amp; file.getName().equals(<span class="string">"target"</span>)) &#123;</div><div class="line">                file = file.getParentFile();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        logger.info(<span class="string">"项目绝对路径获取成功"</span>);</div><div class="line">        <span class="keyword">return</span> FilePathDecodeUtil.pathDecode(file.getAbsolutePath());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取类路径下的所有配置文件列表</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;File&gt; <span class="title">getClasspathFiles</span><span class="params">()</span> </span>&#123;</div><div class="line">        String classes = projectPath + <span class="string">"/target/classes"</span>;</div><div class="line">        String testClasses = projectPath + <span class="string">"/target/test-classes"</span>;</div><div class="line">        List&lt;File&gt; classesFiles = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        findFiles(<span class="keyword">new</span> File(classes), classesFiles);</div><div class="line">        findFiles(<span class="keyword">new</span> File(testClasses), classesFiles);</div><div class="line">        logger.info(<span class="string">"类路径下配置文件列表获取成功：&#123;&#125;"</span>, classesFiles);</div><div class="line">        <span class="keyword">return</span> classesFiles;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//递归遍历类路径下的所有class外的配置文件</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findFiles</span><span class="params">(File file, List&lt;File&gt; files)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (file.isDirectory()) &#123;</div><div class="line">            File[] fs = file.listFiles();</div><div class="line">            <span class="keyword">for</span> (File f : fs) &#123;</div><div class="line">                findFiles(f, files);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (file.getName().endsWith(<span class="string">".xml"</span>) || file.getName().endsWith(<span class="string">".properties"</span>)) &#123;</div><div class="line">                files.add(file);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码本身很简单，读取filters文件夹下的对应环境filter文件，对target目录下的资源文件(<code>.xml</code>或<code>.properties</code>)进行单纯地字符串正则替换的逻辑。<br>剩下的就是直接使用该Runner类进行单元测试即可，它就会在单元测试启动前期替换资源文件中的参数，再执行你的单元测试逻辑，如下：<br><img src="http://upload-images.jianshu.io/upload_images/3932187-a98e821ad7b0afd7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="junit-wdspring.png"></p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>哈哈哈，代码本身很简单，这边有意思的是在<code>@RunWith</code>这边插入预处理代码，就是提供一个思路，主要是网上居然没有这方面的解决方案，如果有大神有更好的思路，不妨来交流交流~</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.coselding.cn/2017/05/04/maven多套环境配置文件和junit冲突问题解决方案/" data-id="cj36al8gc00015qcvsla89k4w" class="article-share-link">分享</a><div class="tags"><a href="/tags/maven/">maven</a><a href="/tags/junit/">junit</a><a href="/tags/filter/">filter</a><a href="/tags/spring-test/">spring-test</a></div><div class="post-nav"><a href="/2017/05/25/Solr6.5.1集群部署和后台管理/" class="pre">Solr 6.5.1集群部署和后台管理</a><a href="/2017/05/04/Quartz调度系统入门和调度高可用实现方案/" class="next">Quartz调度系统入门和调度高可用实现方案</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script>var cloudTieConfig = {
  url: document.location.href,
  productKey: "8c4e8416431747c595ded338559ffe2e",
  target: "cloud-tie-wrapper"
};</script><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/25/Solr6.5.1集群部署和后台管理/">Solr 6.5.1集群部署和后台管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/maven多套环境配置文件和junit冲突问题解决方案/">maven多套环境配置文件和junit冲突问题解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/Quartz调度系统入门和调度高可用实现方案/">Quartz调度系统入门和调度高可用实现方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/Swagger-maven-plugin-环境配置踩坑记录/">Swagger-maven-plugin-环境配置踩坑记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/记毕设过程中遇到的一个InnoDB的坑/">记毕设过程中遇到的一个InnoDB的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/12/知识、任务管理软件个人测评/">知识、任务管理软件个人测评</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/Dubbo入门学习笔记/">Dubbo入门学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/02/ZooKeeper配置和学习笔记/">ZooKeeper配置和学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/21/Pushy入门文档中文翻译/">Pushy入门文档中文翻译</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/15/IntelliJ-IDEA-license-server服务器搭建/">IntelliJ-IDEA-license-server服务器搭建</a></li></ul></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/个人心得/">个人心得</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/">微服务</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/推送/">推送</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/pushy/" style="font-size: 15px;">pushy</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/http-2/" style="font-size: 15px;">http/2</a> <a href="/tags/IntelliJ/" style="font-size: 15px;">IntelliJ</a> <a href="/tags/激活/" style="font-size: 15px;">激活</a> <a href="/tags/jetbrains/" style="font-size: 15px;">jetbrains</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/RPC/" style="font-size: 15px;">RPC</a> <a href="/tags/Dubbo/" style="font-size: 15px;">Dubbo</a> <a href="/tags/SOA/" style="font-size: 15px;">SOA</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/调度/" style="font-size: 15px;">调度</a> <a href="/tags/quartz/" style="font-size: 15px;">quartz</a> <a href="/tags/分布式调度/" style="font-size: 15px;">分布式调度</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/Swagger/" style="font-size: 15px;">Swagger</a> <a href="/tags/自动化/" style="font-size: 15px;">自动化</a> <a href="/tags/RESTful/" style="font-size: 15px;">RESTful</a> <a href="/tags/APNs/" style="font-size: 15px;">APNs</a> <a href="/tags/集群管理/" style="font-size: 15px;">集群管理</a> <a href="/tags/选举/" style="font-size: 15px;">选举</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/折腾/" style="font-size: 15px;">折腾</a> <a href="/tags/环境搭建/" style="font-size: 15px;">环境搭建</a> <a href="/tags/mac实用插件/" style="font-size: 15px;">mac实用插件</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/junit/" style="font-size: 15px;">junit</a> <a href="/tags/filter/" style="font-size: 15px;">filter</a> <a href="/tags/spring-test/" style="font-size: 15px;">spring-test</a> <a href="/tags/经验/" style="font-size: 15px;">经验</a> <a href="/tags/面试/" style="font-size: 15px;">面试</a> <a href="/tags/校招/" style="font-size: 15px;">校招</a> <a href="/tags/时间管理/" style="font-size: 15px;">时间管理</a> <a href="/tags/知识管理/" style="font-size: 15px;">知识管理</a> <a href="/tags/doit-im/" style="font-size: 15px;">doit.im</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/InnoDB/" style="font-size: 15px;">InnoDB</a> <a href="/tags/读写锁/" style="font-size: 15px;">读写锁</a> <a href="/tags/事务/" style="font-size: 15px;">事务</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.zning.net.cn" title="张宁网" target="_blank">张宁网</a><ul></ul><a href="https://cloudups.github.io" title="凌云阁" target="_blank">凌云阁</a><ul></ul><a href="https://noahzu.github.io" title="Android资源开发小栈" target="_blank">Android资源开发小栈</a><ul></ul><a href="https://heinika.github.io/" title="陈利津" target="_blank">陈利津</a><ul></ul><a href="http://www.itfenghui.com/" title="SEO" target="_blank">SEO</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Coselding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5f2780e77f78ddb4e621d840e6d71d90";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>